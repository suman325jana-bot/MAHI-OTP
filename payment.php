<?php require 'core/db.php'; $db = db(); if($_SERVER['REQUEST_METHOD']==='POST' && empty($_GET['action'])){ $product_id=(int)$_POST['product_id']; $name=$db->real_escape_string($_POST['name']); $phone=$db->real_escape_string($_POST['phone']); $db->query("INSERT INTO orders (product_id, customer_name, customer_phone) VALUES ($product_id,'$name','$phone')"); $order_id=$db->insert_id; $p=$db->query("SELECT * FROM products WHERE id=$product_id")->fetch_assoc(); } if(isset($_GET['action']) && $_GET['action']==='confirm' && $_SERVER['REQUEST_METHOD']==='POST'){ $order_id=(int)$_POST['order_id']; $upi=$db->real_escape_string($_POST['upi_id']); $txn=$db->real_escape_string($_POST['upi_txn']); $db->query("UPDATE orders SET upi_id='$upi', upi_txn_id='$txn', status='paid' WHERE id=$order_id"); echo '<p>UPI submitted. Admin will verify.</p><p><a href="index.php">Home</a></p>'; exit; } ?>
<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Payment</title><link rel='stylesheet' href='assets/css/style.css'></head><body><div class='container'><div class='card'><h2>Payment for <?=htmlspecialchars($p['name'] ?? 'Order')?></h2><p class='small'>Amount: â‚¹<?=number_format($p['price'] ?? 0,2)?></p><form method='POST' action='payment.php?action=confirm'><input type='hidden' name='order_id' value='<?=htmlspecialchars($order_id ?? '')?>'><label>UPI ID</label><br><input name='upi_id' required><br><label>UPI TXN ID (optional)</label><br><input name='upi_txn'><br><button class='btn' type='submit'>Submit</button></form><h3>Scan QR</h3><?php if(file_exists(UPI_QR_PATH)){ echo "<img src='".UPI_QR_PATH."' style='max-width:200px'>"; } else { echo '<p class="small">Upload QR in admin panel.</p>'; } ?></div></div></body></html>